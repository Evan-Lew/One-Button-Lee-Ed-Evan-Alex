<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>crisp-game-lib</title>
    <meta
      name="viewport"
      content="width=device-width, height=device-height,
    user-scalable=no, initial-scale=1, maximum-scale=1"
    />
    <script src="https://unpkg.com/sounds-some-sounds@3.0.0/build/index.js"></script>
    <script src="https://unpkg.com/gif-capture-canvas@1.1.0/build/index.js"></script>
    <script src="https://unpkg.com/pixi.js@5.3.0/dist/pixi.min.js"></script>
    <script src="https://unpkg.com/pixi-filters@3.1.1/dist/pixi-filters.js"></script>
    <script src="https://unpkg.com/crisp-game-lib@1.1.0/docs/bundle.js"></script>

<script>
// The title of the game to be displayed on the title screen
title = "APPLE DROP";

// The description, which is also displayed on the title screen
description = `

`;

// The array of custom sprites
characters = [
`
rr
rr
`
];

// Game design variable container
const G = {
	WIDTH: 100,
	HEIGHT: 100,
};

// Game runtime options
options = {
	viewSize: {x: G.WIDTH, y: G.HEIGHT},
    isReplayEnabled: true,
    //isPlayingBgm: true,
    seed: 1,
};

// JSDoc comments for typing
/** @type {Vector[]} */
let apples;

// The game loop function
function update() {
    // The init function running at startup
	if (!ticks) {
        const posX = 45;
        const posY = 10; // floor 32

        apples = [];
        if (apples.length === 0) {
            apples.push({ pos: vec(posX, posY) })
        }

    }
    // Sky color
    color("light_cyan");
    rect(0, 0, 100, 100);

    // Tree
    color("green");
    rect(47, 1, 6, 3);
    rect(44, 4, 12, 3);
    rect(41, 7, 18, 9);
    rect(38, 10, 24, 3);

    // Trunk
    color("black");
    rect(48, 16, 4, 12);

    // Grass
    rect(0, 20, 100, 1);
    color("light_green");
    rect(0, 21, 48, 7);
    rect(52, 21, 48, 7);
    rect(0, 28, 100, 72);

    // Roots
    color("black");
    line(48, 28, 47, 30, 2);
    line(52, 28, 54, 30, 2);
    line(48, 27, 45, 25, 2);
    line(52, 27, 55, 25, 2);

    // Underground
    color("light_black");
    //rect(2, 33, 96, 77); // full rect

    // These rectangles are necessary to ensure the apple keeps moving when on light_black -Evan
    rect(2, 33, 22, 20);
    rect(26, 33, 19, 20);
    rect(24, 70, 2, 1);

    // Left Hole
    color("black");
    rect(21, 33, 8, 1);
    rect(22, 34, 6, 1);

    rect(23, 35, 4, 10);

    // Right Hole
    rect(74, 33, 8, 1);
    rect(75, 34, 6, 1);

    rect(76, 35, 4, 10);

    // First Belt
    color("white");
    rect(20, 45, 63, 7);

    // Draw the apples
    remove(apples, (a) => {
        color("black");
        //char("a", a.pos);
        var isCollidingwithGray = char("a", a.pos).isColliding.rect.light_black;

        // Move the apple to right when touching light_black
        if (isCollidingwithGray) {
            a.pos.x -= 0.1;
        }
        // Drop the apple
        else {
            a.pos.y += 0.6;
        }

        return a.pos.y > 90;
    });
}

addEventListener("load", onLoad);
</script>

  </head>
  <body style="background: #ddd"></body>
</html>